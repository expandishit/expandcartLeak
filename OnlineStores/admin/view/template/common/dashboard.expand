{% extends "base.expand" %}

{% set hideHeader = true %}

{% block content %}
    <style type="text/css">
        .unhandled{
            font-weight: normal;
            font-size: 13px;
        }
        .blue{
        color: #03a9f4; 
        }
    </style>
    <style>
        .pulse {
            display: inline-block;
            -webkit-animation: bounceIn 2s linear infinite;
            -o-animation: bounceIn 2s linear infinite;
            animation: bounceIn 2s linear infinite;
        }
    </style>
    {% if can_access('common/dashboard') %}

    <div class="modal fade success-subscribe-modal center-modal" id="upgrade_plan_modal" tabindex="-1">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="head">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        Ã—
                    </button>
                </div>
                <p class="title">
                    {{lang('success_subscribe_title')}}
                </p>
                <img src="view/assets/images/account/charge/fireworks.svg" alt="" class="img">
                <p class="desc plan-title"></p>
                <p class="desc">{{lang('success_subscribe_sub_desc')}}</p>
                <button type="button" class="theme-btn gold-btn" style="width:100%" data-dismiss="modal">
                    {{lang('dismiss')}}
                </button>
            </div>
        </div>
    </div>

    <div class="modal fade success-subscribe-modal center-modal" id="downgrade_plan_modal" tabindex="-1">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="head">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        Ã—
                    </button>
                </div>
                <p class="title">
                    {{lang('success_downgrade_title')}}
                </p>
                <img src="view/assets/images/account/charge/verified.svg" alt="" class="img">
                <p class="desc plan-title"></p>
                <p class="desc">{{lang('success_downgrade_sub_desc')}}</p>
                <button type="button" class="theme-btn gold-btn" style="width:100%" data-dismiss="modal">
                    {{lang('dismiss')}}
                </button>
            </div>
        </div>
    </div>

    <div class="modal fade success-subscribe-modal center-modal" id="service_subscribe_modal" tabindex="-1">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="head">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        Ã—
                    </button>
                </div>
                <p class="title">
                    {{lang('success_service_title')}}
                </p>
                <img src="view/assets/images/account/charge/fireworks.svg" alt="" class="img">
                <p class="desc service-title"></p>
                <p class="desc">{{lang('success_service_sub_desc')}}</p>
                <button type="button" class="theme-btn gold-btn" style="width:100%" data-dismiss="modal">
                    {{lang('dismiss')}}
                </button>
            </div>
        </div>
    </div>


    <div class="list-wrapper">
        <div class="content-inner">
            {% if (MENU_TOUR == 0) and (gettingStarted_count != '3') %}
            <div class="inner-settings-title mb-10 product-list-title">
                <p class="fb-app-title font-18">
                    {{lang('heading_title')}}
                </p>
                <div class="btns">
                    <button class="theme-btn dark-white-empty" data-toggle="modal" data-target="#end_trial_modal">
                        {{lang('end_trial_btn')}}
                    </button>
                </div>
            </div>
            {# start guide steps #}
            <section class="store-steps">
                <h3 class="sections-title small-img">
                    {{ lang('text_guide_steps') }}
                    <span class="rocket">ðŸš€</span>
                    <img src="view/assets/images/homepage/rocket.svg" alt="">
                </h3>
                <p class="steps-count">
                    <span class="left">
                        {{gettingStarted_count}}
                        {{lang('text_complete')}}
                        <span class="progress">
                            <span class="progress-bar" style="width: {{(gettingStarted_count / 3) * 100}}%"></span>
                        </span>
                    </span>
                    <span class="skip" data-toggle="modal" data-target="#skip_trial_modal">
                        {{lang('skip_trial_btn')}}
                        <i class="fas fa-chevron-right"></i>
                    </span>
                </p>
                <div class="store-step-boxs steps-tabs-content">
                    <div class="store-step-box {{ gettingStarted['CUST_DESIGN'] == '0' ? '' : 'done' }}">
                        <div class="icons">
                            <img src="view/assets/images/homepage/strong.png" alt="">
                            <span class="check">
                                <i class="fas fa-check"></i>
                            </span>
                        </div>
                        <div class="up">
                            <div class="img">
                                <img src="view/assets/images/homepage/pick-design.svg" alt="">
                            </div>
                            <p class="title">
                                {{ lang('text_customize') }}
                            </p>
                            <p class="desc">
                                {{ lang('text_customize_desc') }}
                            </p>
                        </div>
                        
                        <a href="{{ link('setting/template') }}" class="button primary w-100 text-center">
                            {{ lang('button_customize') }}
                        </a>
                    </div>
                    <div class="store-step-box active {{ gettingStarted['ADD_PRODUCTS'] == '0' ? '' : 'done' }}">
                        <div class="icons">
                            <img src="view/assets/images/homepage/good.png" alt="">
                            <span class="check">
                                <i class="fas fa-check"></i>
                            </span>
                        </div>
                        <div class="up">
                            <div class="img">
                                <img src="view/assets/images/homepage/add-product.svg" alt="">
                            </div>
                            <p class="title">
                                {{ lang('text_addproduct') }}
                            </p>
                            <p class="desc">
                                {{ lang('text_addproduct_desc') }}
                            </p>
                        </div>
                        
                        <a href="{{ link('catalog/product/insert') }}" class="button primary w-100 text-center">
                            {{ lang('button_addproduct') }}
                        </a>
                    </div>
                    <div class="store-step-box {{ gettingStarted['ADD_DOMAIN'] and gettingStarted['ADD_DOMAIN'] == '1' ? 'done' : '' }}">
                        <div class="icons">
                            <img src="view/assets/images/homepage/party.png" alt="">
                            <span class="check">
                                <i class="fas fa-check"></i>
                            </span>
                        </div>
                        <div class="up">
                            <div class="img">
                                <img src="view/assets/images/homepage/set-domain.svg" alt="">
                            </div>
                            <p class="title">
                                {{ lang('text_domain') }}
                            </p>
                            <p class="desc">
                                {{ lang('text_domain_desc') }}
                            </p>
                        </div>
                        
                        <a href="{{ link('setting/domains') }}" class="button primary w-100 text-center">
                            {{ lang('button_domain') }}
                        </a>
                    </div>
                </div>
                <div class="text-end mt-15">

                </div>
            </section>
            {# end guide steps #}
            {% endif %}
            <div class="inner-settings-title mb-10 product-list-title">
                <p class="fb-app-title font-18">
                {% if (MENU_TOUR == 1) or (gettingStarted_count == '3') %}
                    {{lang('heading_title')}}
                {% endif %}
                </p>
                <div class="btns">
                    <span class="headLinksEffect not-tutel">
                        <button type="button" class="btn btn-default daterange-ranges heading-btn">
                            <i class="icon-calendar5 position-left"></i>
                            <span></span>
                            <b class="caret"></b>
                        </button>
                    </span>
                </div>
            </div>
            <div class="text-end mb-20">
            </div>
			
			{% if show_lableb_alert %}
            <div class="row">
               <div class="col-md-12">
                    <div class="alert alert-warning media" role="alert">
						<div class="media-left media-middle">
                                <img src="view/image/marketplace/lableb.png" width="48" alt="icon" class="mr-5">
                     </div>
					 <div class="media-body media-middle">
						 {{ lang('text_fresh_indexing_help')  }}
					</div>
						 <div class="media-right media-middle">
						 <a class="btn btn-primary btn-lg" href="{{ link('module/lableb') }}"> {{ lang('text_go_to_lableb')  }}</a>
						</div>
					</div>
                </div>
			</div>
			{% endif %}
			
			{% if whatsapp_show %}
            <div class="row">
               <div class="col-md-12">
                    <div class="panel panel-body" style="height: 114px; display: inline-table;">
                        <div class="media no-margin stack-media-on-mobile" style="vertical-align: middle; display: table-cell;">
                            <div class="media-left media-middle">
                                <img src="view/assets/images/whatsapp/whatsapp-icon2.png" width="48" alt="icon" class="mr-5">
                            </div>

                            <div class="media-body media-middle">
                                <h6 class="media-heading text-semibold"> {{ lang('text_messages_status')|replace({'%%unreaded_messages%%': '<sapn class="whatsapp-msg-num">'~ unreaded_messages_count ~'</sapn>'}) }}</h6>
                            </div>
                            <div class="media-right media-middle">
                                <a class="btn bg-success-300 btn-lg" style="background:#1ebea5;color;" href="{{ link('module/whatsapp/chat') }}"><img src="view/assets/images/whatsapp/WhatsApp_icon.png" width="20" alt="icon" class="mr-5">  {{ lang('text_chatting') }}</a>
                            </div>
                        </div>
                    </div>
                </div>
			</div>
			{% endif %}
			
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-body" style="height: 114px; display: inline-table;">
                        <div class="media no-margin stack-media-on-mobile" style="vertical-align: middle; display: table-cell;">
                            <div class="media-left media-middle">
                                <i class="icon-coin-dollar icon-3x text-blue no-edge-top"></i>
                            </div>

                            <div class="media-body media-middle">
                                <h6 class="media-heading text-semibold">{{ lang('text_orders_status')|replace({'%%orders_today%%': '<sapn class="blue">'~ today_orders_count ~'</sapn>', '%%unhandled_orders%%': '<sapn id="unhandled" class="unhandled blue">'~ lang('text_calculating') ~'</sapn>'}) }}</h6>

                            </div>

                            <div class="media-right media-middle">
                                <a href="{{ link('sale/order') }}" class="btn bg-blue btn-lg"><i class="icon-cart position-left"></i> {{ lang('text_see_orders') }}</a>
                            </div>
                        </div>
                    </div>
                </div>

                {#                <div class="col-md-6">#}
                {#                    <div class="panel panel-body"  style="height: 114px; display: inline-table;">#}
                {#                        <div class="media no-margin stack-media-on-mobile" style="vertical-align: middle; display: table-cell;">#}
                {#                            <div class="media-body media-middle">#}
                {#                                <h3 class="no-margin text-semibold livecount"></h3>#}
                {#                                <span class="text-uppercase text-size-mini text-muted">{{ lang('visitors_now') }}</span>#}
                {#                            </div>#}

                {#                            <div class="media-right media-middle">#}
                {#                                <a href="{{ link('analytics/analytics') }}" class="btn bg-danger-300 btn-lg">#}
                {#                                    <i class="icon-circles pulse position-left"></i> {{ lang('live_report') }}#}
                {#                                </a>#}
                {#                            </div>#}
                {#                        </div>#}
                {#                    </div>#}
                {#                </div>#}
            </div>
            <!-- Main charts -->
            <div class="row not-tutel">
                <div class="col-lg-6">
                    <!-- Revenue stats -->
                    <div class="panel panel-flat">
                        <div class="panel-heading">
                            <h6 class="panel-title bold mb-20">{{ lang('text_revenue') }}</h6>
                            <div class="heading-elements not-collapsible hidden" id="revenue_filter">
                                    <span class="heading-text"><i class="icon-filter3"></i>&nbsp; {{ lang('text_total_period') }}<span class="text-semibold" id="revenue_total"></span></span>
                            </div>
                        </div>
            
                        <div class="container-fluid">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="revenue_today"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_today') }}</span>
                                    </div>
                                </div>
                                                            
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="revenue_yesterday"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_yesterday') }}</span>
                                    </div>
                                </div>
                                                                
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="revenue_thismonth"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_thismonth') }}</span>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="revenue_lastmonth"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_lastmonth') }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                        <div class="panel-body">
                            <div class="chart-container">
                                <div class="chart" id="revenue-chart"></div>
                            </div>
                        </div>
                    </div>
                    <!-- /Revenue stats -->
                </div>

                <div class="col-lg-6">
                    <!-- Orders stats -->
                    <div class="panel panel-flat">
                        <div class="panel-heading">
                            <h6 class="panel-title bold mb-20">{{ lang('text_orders') }}</h6>
                            <div class="heading-elements not-collapsible hidden" id="orders_filter">
                                    <span class="heading-text"><i class="icon-filter3"></i>&nbsp; {{ lang('text_total_period') }}<span class="text-semibold" id="orders_total"></span></span>
                            </div>
                        </div>

                        <div class="container-fluid">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="orders_today"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_today') }}</span>
                                    </div>
                                </div>
                                                    
                                <div class="col-md-3">
                                    <div class="">
                                        <h5 class="text-semibold no-margin" id="orders_yesterday"> 0</h5>
                                        <span class="text-muted text-size-small">{{ lang('text_yesterday') }}</span>
                                    </div>
                                </div>
                                                    
                                <div class="col-md-3">
                                        <div class="">
                                            <h5 class="text-semibold no-margin" id="orders_thismonth"> 0</h5>
                                            <span class="text-muted text-size-small">{{ lang('text_thismonth') }}</span>
                                        </div>
                                    </div><div class="col-md-3">
                                        <div class="">
                                            <h5 class="text-semibold no-margin" id="orders_lastmonth"> 0</h5>
                                            <span class="text-muted text-size-small">{{ lang('text_lastmonth') }}</span>
                                        </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="chart-container">
                                <div class="chart" id="orders-chart"></div>
                            </div>
                        </div>
                    </div>
                    <!-- /Orders stats -->
                </div>
            </div>

            <div class="row not-tutel">
                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body panel-body-accent">
                        <div class="media no-margin">
                            <div class="media-left media-middle">
                                <i class="icon-users4 icon-3x text-success-400"></i>
                            </div>

                            <div class="media-body text-right">
                                <h3 class="no-margin text-semibold" id="recent_customers_count"></h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('text_recent_customers') }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body">
                        <div class="media no-margin">
                            <div class="media-left media-middle">
                                <i class="icon-cash3 icon-3x text-indigo-400"></i>
                            </div>

                            <div class="media-body text-right">
                                <h3 class="no-margin text-semibold" id="average_order_value"></h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('text_average_order_total') }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body">
                        <div class="media no-margin">
                            <div class="media-body">
                                <h3 class="no-margin text-semibold" id="returning_customers_count"></h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('text_returned_customers') }}</span>
                            </div>

                            <div class="media-right media-middle">
                                <i class="icon-cart-add icon-3x text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body">
                        <div class="media no-margin">
                            <div class="media-body">
                                <h3 class="no-margin text-semibold" id="returns_count"></h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('text_total_returns') }}</span>
                            </div>

                            <div class="media-right media-middle">
                                <i class="icon-rotate-ccw3 icon-3x text-danger-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row not-tutel">
                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body">
                        <div class="media no-margin">
                            <div class="media-body">
                                <h3 class="no-margin text-semibold" id="products_count">{{ total_products }}</h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('products') }}</span>
                            </div>
                            <div class="media-right media-middle">
                                <img src="view/assets/images/box.svg" width="40px" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-md-3">
                    <div class="panel panel-body">
                        <div class="media no-margin">
                            <div class="media-body">
                                <h3 class="no-margin text-semibold" id="out_of_stock_count">{{ total_out_of_stock_products }}</h3>
                                <span class="text-uppercase text-size-mini text-muted">{{ lang('out_of_stock') }}</span>
                                <a style="text-decoration: underline; color: rgba(10,10,10,0.63); margin: 13px; font-size: xx-small"
                                class="text-uppercase text-size-mini" href="{{ link('catalog/product?quantity=0') }}">
                                    {{ lang('show_products') }}
                                </a>
                            </div>
                            <div class="no-margin media-right media-small">
                                <img src="view/assets/images/out_of_stock.svg" width="40px" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

	<!-- end trial Modal -->
	<div class="modal fade upgrade-plan-modal center-modal" id="end_trial_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<span class="close-modal">
                    <span data-dismiss="modal" aria-label="Close">
                        Ã—
                    </span>
				</span>
				<p class="title">
					{{lang('end_trial_title')}}
				</p>
				<p class="info-content">
					{{lang('end_trial_content')}}
				</p>
                <div class="text-end">
                    <button class="theme-btn danger-btn"id="end_trial">
                        {{lang('end_trial_modal_btn')}}
                    </button>
                </div>
			</div>
		</div>
	</div>

{% set isTapfiliateLead  = constant('STORE_ATTRIBUTES') is defined  and  (constant('STORE_ATTRIBUTES'))['tapfiliate_ref'] %}

{% if flash_message["status"]== "upgrade" %}
	<!-- scripts used at upgrade plan only -->	
	
	<!-- tapfiliate --> 
	{% if isTapfiliateLead %}
		<script src="https://script.tapfiliate.com/tapfiliate.js" type="text/javascript" async></script>
	{% endif %} 
	<!-- #tapfiliate --> 

{% endif %} 

<script async src="https://www.googletagmanager.com/gtag/js?id=AW-10854895799"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
    gtag('config', 'AW-10854895799');
</script>

    <script>
	
        {% if flash_message["status"]== "upgrade" %}
            $(document).ready(function() {
                $('#upgrade_plan_modal .plan-title').text('{{ lang_printf('success_subscribe_desc', lang(flash_message.title~'_title')) }}');
                $('#upgrade_plan_modal').modal('show');
				
				var transaction		= {{ flash_message["transaction"]|json_encode }} ;
				var transaction_id	= transaction['id'] + '_' + transaction['invoice_id']; //order id is always 0 in our DB so we will use the invoice id instead 

				
				
				/*************** tapfliate tracking *************/
				{% if isTapfiliateLead %}

				  (function(t,a,p){t.TapfiliateObject=a;t[a]=t[a]||function(){ (t[a].q=t[a].q||[]).push(arguments)}})(window,'tap');
				
					var tapfiliate_options = {
											customer_id: '{{ constant("WHMCS_USER_ID") }}' ,
											currency : transaction['currency'] 
										};
										
					tap('create', '19323-82cba9', { integration: "javascript" });
					tap('conversion',  transaction_id , transaction['amount'],tapfiliate_options, 'standard');
				
				{% endif %}
				/*************** # tapfliate tracking *************/
				
                gtag('event', 'conversion', {
                    'send_to': 'AW-10854895799/EeD3CNrn-6MDELehgrgo',
                    'value': transaction['amount_in_usd'],
                    'currency': 'USD',
                    'transaction_id': ''
                });
				
            });
			
        {% elseif flash_message["status"]== "downgrade"  %}
            $(document).ready(function() {
                $('#downgrade_plan_modal .plan-title').text('{{ lang_printf('success_downgrade_desc', lang(flash_message.title~'_title')) }}');
                $('#downgrade_plan_modal').modal('show');
            })
        {% elseif flash_message["status"]== "service"  %}
            $(document).ready(function() {
                $('#service_subscribe_modal .service-title').text('{{ lang_printf('success_service_desc', flash_message.title) }}');
                $('#service_subscribe_modal').modal('show');
            })
        {% endif %}

        // skip-trial
        $('#end_trial').click(function() {
            $(this).addClass('load-btn')
            $.ajax({
                url: '{{ link('common/dashboard/skiptut') }}',
                type: 'post',
                success: function () {
                    window.location.reload()
                }
            }); 
        });

        $(function() {

            var vstartdate = moment().startOf('month');
            var venddate = moment().endOf('month');

            drawCharts(vstartdate.format('YYYY-MM-DD'), venddate.format('YYYY-MM-DD'));
            drawCards(vstartdate.format('YYYY-MM-DD'), venddate.format('YYYY-MM-DD'));
            revenue_ordersData();

            // Switchery toggles
            // ------------------------------
            var switches = Array.prototype.slice.call(document.querySelectorAll('.switch'));
            switches.forEach(function(html) {
                var switchery = new Switchery(html, {color: '#4CAF50'});
            });

            // Daterange picker
            // ------------------------------
            $('.daterange-ranges').daterangepicker(
                {
                    startDate: vstartdate,
                    endDate: venddate,
                    ranges: locales['drp_ranges'],
                    opens: 'left',
                    applyClass: 'btn-small bg-slate-600 btn-block',
                    cancelClass: 'btn-small btn-default btn-block',
                    format: 'MM/DD/YYYY',
                    locale: locales['drp_locale']
                },
                function(start, end) {
                    drp_format($('.daterange-ranges span'), start, end);
                }
            );
            drp_format($('.daterange-ranges span'), vstartdate, venddate);

            $('.daterange-ranges').on('apply.daterangepicker', function(ev, picker) {
                drawCharts(picker.startDate.format('YYYY-MM-DD'), picker.endDate.format('YYYY-MM-DD'));
                drawCards(picker.startDate.format('YYYY-MM-DD'), picker.endDate.format('YYYY-MM-DD'));
            });


            function drawCharts(startdate, enddate) {
                var thismonthSelected = moment().startOf('month').format('YYYY-MM-DD') == startdate && moment().endOf('month').format('YYYY-MM-DD') == enddate;
                Get('{{ link('common/home/revenueChart') }}', {startdate: startdate, enddate: enddate}, function(response) {
                    current_xFormat = '%Y-%m-%d';
                    current_xAFormat = '%b-%d';

                    if (response.indexOf("AM") > 0) {
                        current_xFormat = '%H %p';
                        current_xAFormat = '%H %p';
                    }

                    var returnResult = JSON.parse(response);
                    if(!thismonthSelected) $('#revenue_filter').removeClass('hidden');
                    else $('#revenue_filter').addClass('hidden');
                    $('#revenue_total').text(' ' + returnResult.total);
                    myX = returnResult.x;
                    myY = returnResult.y;
                    myX.splice(0, 0, 'x');
                    myY.splice(0, 0, ' {{ lang('text_revenue') }}');
                    columnsData = [];
                    columnsData.push(myX);
                    columnsData.push(myY);
                    var revenue_chart = c3.generate({
                        bindto: '#revenue-chart',
                        size: { height: 200 },
                        data: {
                            columns: columnsData,
                            type: 'line',
                            xFormat: current_xFormat,
                            x: 'x'
                        },
                        point: {
                            r: 4
                        },
                        color: {
                            pattern: ['#66BB6A']
                        },
                        bar: {
                            width: {
                                ratio: 0.5
                            }
                        },
                        grid: {
                            y: {
                                show: false
                            }
                        },
                        padding: {
                            left: 45,
                            right: 35,
                            bottom: 5,
                            top: 15
                        },
                        legend: {
                            show: false
                        },
                        axis: {
                            y: {
                                tick: {
                                    count: 4,
                                    format: d3.format('.0f')
                                }
                            },
                            x: {
                                type: 'timeseries',
                                tick: {
                                    rotate: 75,
                                    format: current_xAFormat
                                }
                            },

                        }
                    });
                });

                Get('{{ link('common/home/ordersChart') }}', {startdate: startdate, enddate: enddate}, function(response) {
                    current_xFormat = '%Y-%m-%d';
                    current_xAFormat = '%b-%d';

                    if (response.indexOf("AM") > 0) {
                        current_xFormat = '%H %p';
                        current_xAFormat = '%H %p';
                    }

                    var returnResult = JSON.parse(response);
                    if(!thismonthSelected) $('#orders_filter').removeClass('hidden');
                    else $('#orders_filter').addClass('hidden');
                    $('#orders_total').text(' ' + returnResult.total + ' {{ lang('text_orders') }}');
                    myX = returnResult.x;
                    myY = returnResult.y;
                    myX.splice(0, 0, 'x');
                    myY.splice(0, 0, ' {{ lang('text_orders') }}');
                    columnsData = [];
                    columnsData.push(myX);
                    columnsData.push(myY);
                    // Generate chart
                    var orders_chart = c3.generate({
                        bindto: '#orders-chart',
                        size: { height: 200 },
                        data: {
                            columns: columnsData,
                            type: 'bar',
                            xFormat: current_xFormat,
                            x: 'x'
                        },
                        color: {
                            pattern: ['#2196F3']
                        },
                        bar: {
                            width: {
                                ratio: 0.5
                            }
                        },
                        grid: {
                            y: {
                                show: false
                            }
                        },
                        padding: {
                            left: 45,
                            right: 35,
                            bottom: 5,
                            top: 15
                        },
                        legend: {
                            show: false
                        },
                        axis: {
                            y: {
                                tick: {
                                    count: 4,
                                    format: d3.format('.0f')
                                }
                            },
                            x: {
                                type: 'timeseries',
                                tick: {
                                    rotate: 75,
                                    format: current_xAFormat
                                }
                            },

                        }
                    });
                });
            }

            function drawCards(startdate, enddate) {
                Get('{{ link('common/home/cardsData') }}', {startdate: startdate, enddate: enddate}, function(response) {
                    var returnResult = JSON.parse(response);
                    $('#recent_customers_count').empty();
                    $('#average_order_value').empty();
                    $('#returning_customers_count').empty();
                    $('#returns_count').empty();

                    $('#recent_customers_count').text(returnResult.recent_customers_count);
                    $('#average_order_value').text(returnResult.average_order_value);
                    $('#returning_customers_count').text(returnResult.returning_customers_count);
                    $('#returns_count').text(returnResult.returns_count);
                });
            }

            function revenue_ordersData() {
                Get('{{ link('common/dashboard/revenue_ordersData') }}', {}, function(response) {
                    var returnResult = JSON.parse(response);
                    console.log(returnResult);

                    $('#revenue_today').text(returnResult.revenue.today);
                    $('#revenue_yesterday').text(returnResult.revenue.yesterday);
                    $('#revenue_thismonth').text(returnResult.revenue.thismonth);
                    $('#revenue_lastmonth').text(returnResult.revenue.lastmonth);

                    $('#orders_today').text(returnResult.orders.today);
                    $('#orders_yesterday').text(returnResult.orders.yesterday);
                    $('#orders_thismonth').text(returnResult.orders.thismonth);
                    $('#orders_lastmonth').text(returnResult.orders.lastmonth);
                });
            }
        });
    </script>

        <script>
            {#function liveFeed() {#}
            {#    $.ajax({#}
            {#        url: '{{ link('common/dashboard/liveVisits') }}',#}
            {#        dataType: 'json',#}
            {#        async: false,#}
            {#        success: function (response) {#}
            {#            $('.livecount').html('' + response['count']);#}
            {#        } #}
            {#    });#}
            {#}#}

            $(document).ready(function () {
                // liveFeed();
                //
                // var intervalId;
                //
                // $(window).focus(function () {
                //     if (!intervalId)
                //         intervalId = setInterval(liveFeed, 5000);
                // });
                //
                // $(window).blur(function () {
                //     clearInterval(intervalId);
                //     intervalId = 0;
                // });

                //Calculate unhandled_orders_count
                $.ajax({
                    url: '{{ link('common/home/GetUnhandledOrdersCount') }}',
                    type: 'post',
                    data: {},
                    success: function (resp) {
                        console.log(resp);
                        var response = JSON.parse(resp);
                        $('#unhandled').removeClass('unhandled');
                        if (response.count != 0){
                            $('#unhandled').text(response.count);
                        }else{
                            $('#unhandled').text(0);
                        }
                    }
                });
            });

        </script>
    {% endif %}
{% endblock content %}
