<link rel="stylesheet" href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

<script src="{{ designdic }}javascript/jquery.ui.touch-punch.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">
<script type="text/javascript" src="{{ designdic }}javascript/jquery/tabs.js"></script>
<script type="text/javascript" language="javascript" src="{{ designdic }}javascript/js_ct_uploader-min.js"></script>
<script type="text/javascript" language="javascript" src="{{ designdic }}javascript/ajaxupload.3.5.js"></script>
<script type="text/javascript" language="javascript" src="{{ designdic }}javascript/jquery.contextmenu.js"></script>
<script type="text/javascript" language="javascript" src="{{ designdic }}javascript/jscolor.js"></script>
<script type="text/javascript" language="javascript" src="{{ designdic }}javascript/html2canvas.min.js"></script>
<script type="text/javascript">
    $('#front').show();
</script>
<style type="text/css">
  {% if lang('direction') == 'rtl' %}
  @import url('https://fonts.googleapis.com/css?family=Cairo:400,600');

  body {
    font-family: 'Cairo', sans-serif !important;
  }

  .theme_a {
    font-family: 'Cairo', sans-serif !important;
  }

  div#bottom_panel {
    direction: rtl;
    padding-right: 26px;
  }

  #tab-text .tab_inner_box {
    direction: rtl;
  }

  #bottom_panel b {
    margin-left: 10px;
  }

  #top_bar > div {
    line-height: 21px;
  }
  {% endif %}

  {% if lang('direction') == 'ltr' %}
  @import url(https://fonts.googleapis.com/css?family=Open+Sans:400,600,700);

  body {
    font-family: 'Open Sans', sans-serif !important;
  }

  .theme_a {
    font-family: 'Open Sans', sans-serif !important;
  }

  #bottom_panel b {
    margin-right: 10px;
  }

  #bottom_panel {
    padding-top: 30px !important;
  }
  {% endif %}

#main_content {
	width:100%;
	height:510px;
	margin:auto;
	background:#FFFFFF;
}
.btnstyle {
	background: none repeat scroll 0 0 #FFFFFF;
	border: 1px solid #FFFFFF;
	border-radius: 8px 8px 8px 8px;
	color: red;
	display: block;
	font-size: 12px;
	font-weight: bold;
	width: 100px;
	text-align:center;
	text-decoration:none;
}
.btnstyle:hover {
	background: none repeat scroll 0 0 #CCCCCC;
	border: 1px solid #FFFFFF;
	border-radius: 8px 8px 8px 8px;
	color: red;
	display: block;
	font-size: 12px;
	font-weight: bold;
	width: 100px;
}
#left_placeholder {
	width:30.4%;
	height:100%;
	float:left;
	border-right:solid 1px #fff;
}
#right_placeholder {
	width:60.4%;
	height:100%;
	float:left;
}
#design_div {
	clear:both;
	width:100%;
	height:100%;
	overflow: scroll;
}
.header_text {
	color: #000;
	margin-left:8px;
	/*font-style:<?php echo $cust_price_text_bold; ?>;*/
	font-size:16px;
	font-weight:bold;
	text-align:center;
}
.spacer {
	margin-bottom:15px;
}
.tab_inner_box {
	margin-left:8px;
}
/*Tab*/
	.htabs {
	/*padding: 0px 0px 0px 10px;*/
	padding: 0px 0px 0px 0px;
	height: 30px;
	line-height: 16px;
	/*border-bottom: 1px solid #DDDDDD;*/
	margin-bottom: 15px;
}
.htabs a {
	background: #FFFFFF;
	padding: 7px 15px 6px 15px;
	float: left;
	font-size: 10px;
	font-weight: bold;
	text-align: center;
	text-decoration: none;
	color: #000;
	margin-right: 2px;
  	border-radius:8px;
}
.htabs a.selected {
	padding-bottom: 6px;
	background: #ccc;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
#upload {
	/*background:#F1E3C5;
	border-radius:7px;
	text-align:center;
	display:inline-block;*/
	margin-top:15px;
	margin-left:45px;/*box-shadow:0 3px 0 -1px #F5EBD6 inset, 0 -2px 0 0 #E2C587 inset*/
}
#tab-clip {
	clear:both;
}
.carts {
	float:left;
	margin:5px;
}
#tab-clip img {
	cursor:pointer;
}
#design_area {
	width:65%;
	height:65%;
	margin-top:2%;
	text-align:center;
	float:left;
}
#thumb {
	margin-top:50px;
	float:left;
	margin-left:40px;

}
#thumb div {
	width:30px;
	height:35px;
	margin:5px;
	text-align:center;
}
#thumb img {
	width:27.5px;
	height:32.87px;
	outline:none !important;
}
/**/
	.drag {
	width: 100px;
	height: 100px;
	border: 1px solid black;
	cursor: pointer;
	border-radius: 10px;
	text-algin: center;
	background-color: lightpink;
}
.resize {
	position:absolute;/*border-color:black;
    border-style:solid;
    border-width:1px;*/
}
.ui-resizable-se {
	width: 7px;
	height: 7px;
	background-color: #D0F2F0;
	border-color:#45C1B1;
	border-style:solid;
	border-width:1px;
	bottom:0px;
	right:0px;
}
.ui-resizable-sw {
	width: 7px;
	height: 7px;
	background-color: #D0F2F0;
	border-color:#45C1B1;
	border-style:solid;
	border-width:1px;
	bottom:0px;
	left:0px;
}
.ui-resizable-nw {
	width: 7px;
	height: 7px;
	background-color: #D0F2F0;
	border-color:#45C1B1;
	border-style:solid;
	border-width:1px;
	top:0px;
	left:0px;
}
.ui-resizable-ne {
	width: 12px;
	height: 12px;
	cursor:pointer;
	/*background-color: #D0F2F0;
	 border-color:#45C1B1;
	 border-style:solid;
	 border-width:1px;*/
	 background:url(delete.png) !important;
	top:0px;
	right:0px;
}

#front {
	/* width:350px; */
	height:350px;
	margin:auto;
	/*box-shadow:0px 0px 20px #000;*/
	border-radius:14px;
	display: none;
}
#back {
	width:350px;
	height:350px;
	margin:auto;
	/*box-shadow:0px 0px 20px #000;*/
	border-radius:14px;
	display: none;
}
#image_placeholder_front {
	background:url('{{mug_front_image_big}}') no-repeat;
	background-position: center;
    background-size: contain;
	width:100%;
	height:350px;
	margin: 0px 10px auto;
	position: relative;
}
#image_placeholder_back {
	background:url('{{mug_back_image_big}}') no-repeat;
	width:350px;
	height:350px;
	margin: 0px 10px auto;
}
.zoom {
	width:27.5px;
	height:32.87px;
	-moz-transition:-moz-transform 0.1s ease-in;
	-webkit-transition:-webkit-transform 0.1s ease-in;
	-o-transition:-o-transform 0.1s ease-in;
	position:absolute;
	cursor:pointer;
}
.zoom:hover {
	-moz-transform:scale(2);
	-webkit-transform:scale(2);
	-o-transform:scale(2);
	position:absolute;
	z-index:9000000;
}
.tab_inner_box span {
	color: #000;
	font-weight:bold;
	font-size:12px;
}
select {
	font-size:12px;
}
input[type='text'] {
	font-size:11px;
}
#top_bar {
	background:url('{{designdic}}image/tab.png') repeat;
	height:30px;
	width:100%;
	clear:both;
    visibility: hidden;
}
#top_bar div {
	float:left;
	padding-left:10px;
}
#bottom_panel {
	clear:both;
	width:100%;
	padding-top:20px;
	float:right;
}
#bottom_panel b {
	color: #000;
}
#imageHolder {
	display:none;
}
.error {
	color:red;
	font-weight:bold;
}
#addprocess {
	display:none;
}
input[type="text"], input.text, textarea {
	background: none repeat scroll 0 0 #FFFFFF;
	border: 1px solid #CED5D9;
	border-radius: 3px 3px 3px 3px;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15) inset;
	color: #7A8F99;
	font: 12px sans-serif;
	padding: 6px;
}
input[type="text"]:focus, input.text:focus, textarea:focus {
	border-color: #49C1FD;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) inset, 0 0 3px #3DC0FF;
	outline: medium none;
}
select {
	background: none repeat scroll 0 0 #FFFFFF;
	border: 1px solid #CED5D9;
	border-radius: 3px 3px 3px 3px;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15) inset;
	color: #7A8F99;
	font: 12px sans-serif;
	padding: 3px;
}
select:focus {
	border-color: #49C1FD;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) inset, 0 0 3px #3DC0FF;
	outline: medium none;
}
textarea{resize: none;}
/*Add to cart button themming*/

.theme_a {
	background: -moz-linear-gradient(center top, #EDEDED 5%, #DFDFDF 100%) repeat scroll 0 0 #EDEDED;
	border: 1px solid #DCDCDC;
	border-radius: 6px 6px 6px 6px;
	box-shadow: 0 1px 0 0 #FFFFFF inset;
	color: #777777;
	display: inline-block;
	font-size: 13px;
	font-style: normal;
	font-weight: bold;
	height: 31px;
	line-height: 31px;
	text-align: center;
	text-decoration: none;
	text-indent: 0;
	text-shadow: 1px 1px 0 #FFFFFF;
	width: 100px;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_a:hover {
	background: -moz-linear-gradient(center top, #DFDFDF 5%, #EDEDED 100%) repeat scroll 0 0 #DFDFDF;
}
.theme_a:active {
	position: relative;
	top: 1px;
}
.theme_b {
    background: linear-gradient(to bottom, #2DABF9 5%, #0688FA 100%) repeat scroll 0 0 #2DABF9;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 -3px 7px 0 #29BBFF inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 0 1px 0 #263666;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_b:hover {
    background: linear-gradient(to bottom, #0688FA 5%, #2DABF9 100%) repeat scroll 0 0 #0688FA;
}
.theme_b:active {
    position: relative;
    top: 1px;
}
.theme_c {
    background: linear-gradient(to bottom, #3D94F6 5%, #1E62D0 100%) repeat scroll 0 0 #3D94F6;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 -3px 7px 0 #29BBFF inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 0 1px 0 #263666;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_c:hover {
    background: linear-gradient(to bottom, #0688FA 5%, #2DABF9 100%) repeat scroll 0 0 #1E62D0;
}
.theme_c:active {
    position: relative;
    top: 1px;
}
.theme_c {
    background: linear-gradient(to bottom, #3D94F6 5%, #1E62D0 100%) repeat scroll 0 0 #3D94F6;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 -3px 7px 0 #29BBFF inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 0 1px 0 #263666;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_c:hover {
    background: linear-gradient(to bottom, #0688FA 5%, #2DABF9 100%) repeat scroll 0 0 #1E62D0;
}
.theme_c:active {
    position: relative;
    top: 1px;
}
.theme_d {
    background: linear-gradient(to bottom, #F24537 5%, #C62D1F 100%) repeat scroll 0 0 #F24537;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #F5978E inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #810E05;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_d:hover {
    background: linear-gradient(to bottom , #C62D1F 5%, #F24537 100%) repeat scroll 0 0 #C62D1F;
}
.theme_d:active {
    position: relative;
    top: 1px;
}
.theme_e {
    background: linear-gradient(to bottom, #9DCE2C 5%, #8CB82B 100%) repeat scroll 0 0 #9DCE2C;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #C1ED9C inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #689324;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_e:hover {
    background: linear-gradient(to bottom, #8CB82B 5%, #9DCE2C 100%) repeat scroll 0 0 #8CB82B;
}
.theme_e:active {
    position: relative;
    top: 1px;
}
.theme_f {
    background:  linear-gradient(to bottom, #F6B33D 5%, #D29105 100%) repeat scroll 0 0 #F6B33D;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #FED897 inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #CD8A15;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_f:hover {
    background: linear-gradient(to bottom , #D29105 5%, #F6B33D 100%) repeat scroll 0 0 #D29105
}
.theme_f:active {
    position: relative;
    top: 1px;
}
.theme_g {
    background: linear-gradient(to bottom , #C579FF 5%, #A341EE 100%) repeat scroll 0 0 #C579FF;
    border: 1px solid #0B0E07;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #E6CAFC inset;
    color: #FFFFFF;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #8628CE;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_g:hover {
    background: linear-gradient(to bottom , #A341EE 5%, #C579FF 100%) repeat scroll 0 0 #A341EE;
}
.theme_g:active {
    position: relative;
    top: 1px;
}
.theme_h {
    background: linear-gradient(to bottom , #F9F9F9 5%, #E9E9E9 100%) repeat scroll 0 0 #F9F9F9;
    border: 1px solid #DCDCDC;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #FFFFFF inset;
    color: #666666;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #FFFFFF;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_h:hover {
    background: linear-gradient(to bottom , #E9E9E9 5%, #F9F9F9 100%) repeat scroll 0 0 #E9E9E9;
}
.theme_h:active {
    position: relative;
    top: 1px;
}
.theme_i {
    background: linear-gradient(to bottom , #3D94F6 5%, #1E62D0 100%) repeat scroll 0 0 #3D94F6;
    border: 1px solid #337FED;
    border-radius: 3px 3px 3px 3px;
    box-shadow: 0 1px 0 0 #97C4FE inset;
    color: #fff;
    display: inline-block;
    font-size: 15px;
    font-weight: normal;
    padding: 6px 23px;
    text-decoration: none;
    text-shadow: 1px 1px 0 #1570CD;
	cursor:pointer;
	-moz-border-radius: 8px;
    -webkit-border-radius: 8px;
    -khtml-border-radius: 8px;
    border-radius: 8px;;
}
.theme_i:hover {
    background: linear-gradient(to bottom , #1E62D0 5%, #3D94F6 100%) repeat scroll 0 0 #1E62D0;
}
.theme_i:active {
    position: relative;
    top: 1px;
}
	.delete_icon{
		background:url('{{designdic}}/icons/trash.png');
		width:11px;
		height:14px;
		display:none;
		background-repeat:no-repeat;
		z-index:10000;
		position:absolute;
		cursor:pointer;
	}

.option {
    display: inline-block;
}
.error::before {
    content: " ";
    color: black;
    margin: 0 10px;
}

@media only screen and (max-width: 600px) {
  .ui-resizable-se, .delete_icon {
  	display: block !important;
  }
}

</style>
<div id="main_content">
  <div id="design_div">
    <div id="col-md-12">
      <div id="tabs" class="htabs">
        <a href="#tab-clip">{{tab_3_text}}</a>
        <a href="#tab-image">{{tab_2_text}}</a>
        <a href="#tab-text">{{tab_1_text}}</a>
      </div>
      <div id="tab-text">
        <div class="header_text" style="display:none;">{{header_text_1}}</div>
        <div class="tab_inner_box">
          <div>
            <table cellpadding="2" cellspacing="2">
              <tr>
                <td><span>{{font_text}}</span></td>
                <td>
                	<select name="optfont" id="optfont">
                    {% for fontall in font_coll %}
               		<option value="{{ fontall.font }}">{{ fontall.font }}</option>
                    {% endfor %}
                  	</select></td>
              </tr>
              <tr>
                <td><span>{{color_text}}</span></td>
                <td><input type="text" size="5" id="tcolor"  class="color" /></td>
              </tr>
              <tr>
                <td valign="top"><span>{{text_tex}}</span></td>
                <td><textarea name="designtext" placeholder="Write Your Text" id="designtext" rows="2" cols="20"></textarea></td>
              </tr>
              <tr>
                <td>&nbsp;</td>
                <td><input class="{{theme_button}}" id="add_text_button"  type="button" value="{{add_text_button}}" />
                  &nbsp;&nbsp; <img src="{{designdic}}images/al.gif" id="ajaxloader" style="display:none;" /></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div id="tab-image">
        <div class="header_text" style="display:none;">{{header_text_2}}</div>
        <div id="upload" class="{{theme_button}}" style='display:block;width:100px;' align="left">{{upload_text}}</div>
        <div style="margin-left:50px;margin-top:15px;"><img src="{{designdic}}images/al.gif" id="alimageupload" style="display:none;" /></div>
      </div>
      <div id="tab-clip">
        <div class="header_text spacer" style="display:none;">{{header_text_3}}</div>
        <div id='added_logo_loader' style="display:none;position:absolute;top:0;left:0;margin-left:100px; margin-top:200px;">
			<img style="width:32px !important; height:32px !important;" src="{{designdic}}image/al.gif" />
		</div>
		<div id="catlist" style="overflow:auto;height:auto;">
        {% for catlist in categorylist %}
        <div style="float:left;color:#CC3300;font-weight:bold;margin:6px;font-size:13px;">
            <div align="center"><a style="color: #000;text-decoration:none;" href="javascript:void(0);" onClick="loadImage({{ catlist.caid }});"><img src="{{ catlist.category_image }}" /></a></div>
            <div><a style="color:#000;text-decoration:none;" href="javascript:void(0);" onClick="loadImage({{ catlist.caid }});">{{ catlist.category_name }}</a></div>
        </div>
        {% endfor %}
        </div>
        <div id="showimages" style="display:none;overflow:auto;height:auto;"></div>
        <div style="clear:both;"></div>
      </div>

    </div>
    <div id="col-md-12">
      <div id="top_bar">
        <div style="margin:5px 0px 0px 80px;color:{{cust_price_color}};text-decoration:{{text_style}};">
          <span></span>&nbsp;{{price_text}}
        </div>
      </div>
      <div id="design_area">
        <div id="front" onmouseover='hideCorner(1);' onmouseout='hideCorner(2);'>
          <div id="image_placeholder_front"></div>
        </div>
        <div id="back" onmouseover='hideCorner(1);' onmouseout='hideCorner(2);'>
          <div id="image_placeholder_back"></div>
        </div>
      </div>
      <div id="thumb">
        <div><img class="zoom" onClick="setImage('front', this);" title="front" src="{{mug_front_image_thumb}}" data-org="{{ mug_front_image_big }}" /></div>
		{% for option in options %}
			{% for option_value in option.product_option_value %}
              {% if option_value.image is not null  %}
				<div><img class="zoom" onClick="setImage('front', this);" title="front" src="{{option_value.image}}" data-org="{{ option_value.image }}" /></div>
              {% endif %}
			{% endfor %}
		{% endfor %}
		{% if mug_back_image_thumb != '' %}
        <div><img class="zoom" onClick="setImage('back');" title="back" src="{{mug_back_image_thumb}}" /></div>
		{% endif %}
      </div>
	  <div style="clear:both;"></div>
      <div id="bottom_panel">
        {% if options is defined %}
        <form name="frmDesign" id="frmDesignUpload" enctype="multipart/form-data" style="margin:0px">
          <div class="product-info">
            <table>

                {% for option in options %}
              <tr>
                <td>
                {% if option.type == 'select' %}
                  <div id="option-{{ option.product_option_id }}" class="option">
                    {% if option.required %}
                    <span class="required">*</span>
                    {% endif %}
                    <b>{{ option.name }}:</b>
                    <select name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" data-po-id="{{option.product_option_id}}" class="form-control pov">
                <option value="">{{ text_select }}</option>
                {% for option_value in option.product_option_value %}
                <option value="{{ option_value.product_option_value_id }}">{{ option_value.name }}
                {% if option_value.price %}
                ({{ option_value.price_prefix }}{{ option_value.price }})
                {% endif %} </option>
                {% endfor %}
              </select>
                  </div>
                {% endif %}
                  {% if option.type == 'radio' %}
                    <div id="option-{{ option.product_option_id }}" class="option">
                      {% if option.required %}
                        <span class="required">*</span>
                      {% endif %}
                    <b>{{ option.name }}:</b>
                      {% for option_value in option.product_option_value %}
                        {{ option_value.name }} <input type="radio" name="option[{{ option.product_option_id }}]"
                                                       value="{{ option_value.product_option_value_id }}"
                                                       id="input-option{{ option.product_option_id }}" class="form-control" />
                      {% endfor %}
                    </div>
					
					{% elseif option.type == 'text' %}
						<div id="option-{{ option['product_option_id'] }}"
							class="option form-group">
							<label for="option[{{ option['product_option_id'] }}]">
							{{ option['name'] }} 
							{% if option.required %}
								<span class="required">*</span>
							{% endif %}
							</label>

							<div class="control">
								<input type="text" class="form-control"
									name="option[{{ option['product_option_id'] }}]"
									value="{{ option['option_value'] }}"/>
							</div>
						</div>
				    <!-- ######################### Textarea -->
					{% elseif option.type == 'textarea' %}
						<div id="option-{{ option['product_option_id'] }}"
							class="option form-group">
							<label for="option[{{ option['product_option_id'] }}]">
							{{ option['name'] }} 
							{% if option.required %}
								<span class="required">*</span>
							{% endif %}
							</label>

							<div class="control">
								 <textarea class="form-control"
									name="option[{{ option['product_option_id'] }}]"
									cols="40"
									rows="2">{{ option['option_value'] }}</textarea>
							</div>
						</div>
					<!-- ######################### Checkbox -->

					{% elseif option.type == 'checkbox' %}
					<fieldset id="option-{{ option['product_option_id'] }}"
							class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						{% for option_value in option.option_value %}
						<div class="form-check">
							<label class="form-check-label">
								<input type="checkbox" class="form-check-input"
									name="option[{{ option['product_option_id'] }}][]"
									id="option-value-{{ option_value['product_option_value_id'] }}"
									value="{{ option_value['product_option_value_id'] }}" onclick="getCheckboxPrice('{{ option_value['price_value'] }}', '{{ option_value['price_prefix'] }}',this.checked)"
									{% if option_value.quantity <= 0 %}disabled="disabled"{% endif %}
									>
								<span {% if option_value.quantity <= 0 %}class="over_line"{% endif %}>
									{{ option_value['name'] }}
								</span>
								{# OPTION PRICE #}
								{% if config('config_show_option_prices') == '1' %}
									{% if option_value.price %}
										({{ option_value.price_prefix }}{{ option_value.price }})&#x200E;
									{% endif %}
								{% endif %}
								{# /OPTION PRICE #}

							</label>
						</div>
						{% endfor %}
					</fieldset>

					<!-- ######################### Image -->

					{% elseif option.type == 'image' %}
					<fieldset id="option-{{ option['product_option_id'] }}"
							class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						{% for option_value in option.option_value %}
						<div class="form-check">
							<label class="form-check-label">
								<input type="radio" class="form-check-input"
									name="option[{{ option['product_option_id'] }}]"
									value="{{ option_value['product_option_value_id'] }}"
									id="option-value-{{ option_value['product_option_value_id'] }}"  onclick="getRadioPrice('{{ option_value['price_value'] }}', '{{ option_value['price_prefix'] }}','{{ option.product_option_id }}', 'radio')"
									{% if option_value.quantity <= 0 %}disabled="disabled"{% endif %}
									/>
								<img src="{{ option_value['image'] }}"
									alt="{{ option_value['name'] }}{{ option_value['price'] ? ' ' ~ option_value['price_prefix'] ~ option_value['price'] : ''}}"/>
								<span {% if option_value.quantity <= 0 %}class="over_line"{% endif %}>
									{{ option_value['name'] }}
								</span>
								{% if option_value.price %}
									({{ option_value.price_prefix }}{{ option_value.price }})&#x200E;
								{% endif %}
							</label>
						</div>
						{% endfor %}
						<input type="hidden" 
								id="old_radio_price-{{ option.product_option_id }}" 
								value="">
						<input type="hidden" 
								id="old_radio_prefix-{{ option.product_option_id }}" 
								value="">
					</fieldset>

					 <!-- ######################### File -->

					{% elseif option.type == 'file' %}
					<div id="option-{{ option['product_option_id'] }}"
						class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						<div class="control">
							<input class="form-control button" type="button"
								value="{{ lang('button_upload') }}"
								id="button-option-{{ option['product_option_id'] }}"/>
								<span style="padding-left: 10px" id="filename-option-{{ option['product_option_id'] }}"></span>
							<input type="hidden"
								name="option[{{ option['product_option_id'] }}]"
								value=""/>
						</div>
					</div>

					<!-- ######################### Date -->

					{% elseif option.type == 'date' %}
					<div id="option-{{ option['product_option_id'] }}"
						class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						<div class="control">
							<input class="form-control date" type="text"
								name="option[{{ option['product_option_id'] }}]"
								value="{{ option['option_value'] }}"/>
						</div>
					</div>

					<!-- ######################### Datetime -->

					{% elseif option.type == 'datetime' %}
					<div id="option-{{ option['product_option_id'] }}"
						class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						<div class="control">
							<input class="form-control datetime" type="text"
								name="option[{{ option['product_option_id'] }}]"
								value="{{ option['option_value'] }}"/>
						</div>
					</div>

					<!-- ######################### Time -->
					
					{% elseif option.type == 'time' %}
					<div id="option-{{ option['product_option_id'] }}"
						class="option form-group">
						<label for="option[{{ option['product_option_id'] }}]">{{ option['name'] }} {{ option.required ? '<sup>*</sup>' : '' }} </label>

						<div class="control">
							<input class="form-control time" type="text"
								name="option[{{ option['product_option_id'] }}]"
								value="{{ option['option_value'] }}"/>
						</div>
					</div>
				  {% endif %}
				  
				  </td>
              </tr>
                {% endfor %}

            </table>
            <input type="hidden" name="product_id" id="product_id" value="{{ pId }}" />
          </div>
        </form>
        {% endif %}
        <table>
          <tr>
            <td><b>{{ qty_text }}</b></td>
            <td><input id="quantity" type="text" size="1" name="quantity" value="1"></td>
            <td><a class="{{ theme_button }}" href="javascript:void(0);" id="add_to_cart">{{ add_to_cart }}</a></td>
            <td><span id="addprocess"><img src="{{ designdic }}image/al.gif"></span></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
<div title="Design Preview" id="imageHolder"></div>
<form method="post" enctype="multipart/form-data" id="sform">
  <input type="hidden" name="arrayobjectfront" id="arrayobjectfront" />
  <input type="hidden" name="arrayobjectback" id="arrayobjectback" />
</form>
<input type="hidden" name="sidechnage" id="sidechnage" value="front" />
<input type="hidden" name="uniqid" id="uniqid" value="{{uniqid}}" />

<input type="hidden" id="lastTshirtId" value="" />
<input type="hidden" id="custom_front_price" value="{{ customprice['front'] ?? 0 }}" />
<input type="hidden" id="custom_back_price" value="{{ customprice['back'] ?? 0 }}" />
<script type="text/javascript">
  var design_work_front = new Array();
  var design_work_back = new Array();
  const options = JSON.parse('{{options|json_encode()}}');
  
  $('.pov').on('change', function(e) {
	  const selected_option = $(this).data('po-id');
	  const selected_option_value = $(this).val();
	  const option = options.find(el => el.product_option_id == selected_option);
	  if (typeof ovs == undefined) {
		  return;
	  }
	  const ov = option.product_option_value.find(el => el.product_option_value_id == selected_option_value);
	  if (typeof ovs == undefined) {
		  return;
	  }
	  $('#image_placeholder_front').css('background-image', 'url(' + ov.image + ')');
  });

  function makeObjDragAndResize(id,box){
  	window.zindex = 30;
    $("#"+id).resizable({
		handles: 'se',
		stop: function( event, ui ) {
			updateArrayObjectById(id,'resize_width', ui.size.width);
			updateArrayObjectById(id,'resize_height', ui.size.height);
		}
	});
    $("#"+id).parent().draggable({
        containment: "#" + box,
		scroll: false,
		cursor: 'move',
		stop: function(event, ui) {
			var top = jQuery("#"+id).offset().top - jQuery("#"+box).offset().top;
			var left = jQuery("#"+id).offset().left - jQuery("#"+box).offset().left;
			updateArrayObjectById(id,'drag_top', top.toFixed(2));
			updateArrayObjectById(id,'drag_left', left.toFixed(2));
		  }
    });
    /*$("#"+id).rotate({
        bind: {
            dblclick: function() {
                $(this).data('angle', $(this).data('angle')+90);
                var w = $(this).css('width');
                $(this).parent().rotate({ animateTo: $(this).data('angle')});
				$('#image_rotate_angle').val($(this).data('angle'));
				updateArrayObjectById(id,'rotate_angle',$(this).data('angle'));
            }
        }
    });*/
  }

  $('#add_text_button').click(function (e) {
      var designtext = $('#designtext').val();

      if (designtext < 1) {
          return false;
      } else {
          createTextToImage();
      }
  });

  $('#add_to_cart').click(function (e) {
      if (design_work_front.length == 0 && design_work_back.length == 0) {
          var qty = jQuery("#quantity").val();
          addCartProduct(qty, {{ pId }});
      } else {
          saveDesign({{ pId }});
      }
  });

  /**
   * 0 = neither front or back design
   * 1 = front design only
   * 2 = back design only
   * 3 = both front and back design
   * */
  var designFormat = 0;

  function showTopBar()
  {
      var frontPrice = parseFloat($('#custom_front_price').val());
      var backPrice  = parseFloat($('#custom_back_price').val());

      var sideChange = $('#sidechnage').val();

      var topBar = $('#top_bar');
      var priceSpan = $('#top_bar div span');

      var innerPrice;

      if (topBar.css('visibility') == 'hidden') {
          topBar.css('visibility', 'visible');
      }

      if (sideChange == 'front' && designFormat == 0) {
          designFormat = 1;
      } else if (sideChange == 'back' && designFormat == 0) {
          designFormat = 2;
      } else {
          designFormat = 3;
      }

      if (design_work_front.length == 0) {
          frontPrice = 0;
      }

      if (design_work_back.length == 0) {
          backPrice = 0;
      }

      if (design_work_front.length == 0 && design_work_back.length == 0) {
          topBar.css('visibility', 'hidden');
      }

      if (designFormat == 0) {
          innerPrice = 0;
      } else if (designFormat == 1) {
          innerPrice = frontPrice;
      } else if (designFormat == 2) {
          innerPrice = backPrice;
      } else if (designFormat == 3) {
          innerPrice = frontPrice + backPrice;
      }

      priceSpan.html(innerPrice.toFixed(2));
  }

  function storeIntoArray(id,image,drag_top,drag_left,resize_height,resize_width,rotate_angle, img_source) {
  	//removeOldFromArray(id);
	var myObject = {
	  'id' : id,
	  'image' : image ,
	  'drag_top' : drag_top ,
	  'drag_left' : drag_left ,
	  'resize_height' : resize_height ,
	  'resize_width' : resize_width ,
	  'rotate_angle' : rotate_angle ,
	  'source' : img_source ,
	  'modified_image': '',
      'custom_price': $('#custom_' + $('#sidechnage').val() + '_price').val()
	};
	if($('#sidechnage').val() == 'front'){
		design_work_front.push(myObject);
	}
	else if($('#sidechnage').val() == 'back'){
		design_work_back.push(myObject);
	}
      showTopBar();
  }

  function removeImage(id){
	$('#' + id).remove();
	removeOldFromArray(id);
    showTopBar();
  }
  function addImageToRemovePanel(id,src){
  	$("#image_coll").append("<div id=ss_"+ id +" class='deleteDiv'><a href='javascript:void(0);' onclick=removeImage('" + id + "');><img id="+ id +" class='imgremove' width='40' height='40' data-angle='0' src=" + src + " /></a></div>");
  }

function copyImageBeforeSendPanel(obj,img_path){
	$('#added_logo_loader').show();
	$.ajax({
		type: "POST",
		url: 'index.php?route=module/product_designer/copyImage',
		//data: 'simage=' + obj.attributes[0].nodeValue.split('/'),
		data: 'simage=' + obj+'&pimage='+img_path,
		success: function(msg) {
			//success
			if(msg != '-1'){
				setTimeout("sendImageToPanel('" + msg + "')",1000);
			}
			else{
				alert('Error Occured, please reload the again');
				$('#added_logo_loader').hide();
			}
		},
	});
  }

  function sendImageToPanel(image){
	var uniqId = uniqueid();
	var image_url = "{{ dirImage }}modules/pd_images/upload_image/" + image;
	$("#image_placeholder_"+$('#sidechnage').val()).append("<div style='position:absolute;top:35%;left:60%;'><img id="+ uniqId +" class='resize' width='80' height='80' data-angle='0' src=" + image_url + " /></div>");
	makeObjDragAndResize(uniqId,$('#sidechnage').val());
	// store into array from clip art tab
	storeIntoArray(uniqId,image,0,0,0,0,0, 'clipart');
	$("#"+uniqId).before("<div title='Delete' id=rmv_" + uniqId +" onclick=removeImage('" + uniqId + "'); class='delete_icon'></div>");
	hideCorner(2);
	$('#added_logo_loader').hide();
	//addImageToRemovePanel(uniqId,obj.src)
  }

  function sendImageToPanelAfterUplaod(image_name){
	var uniqId = uniqueid();
	var image_url = 'index.php?route=module/product_designer/readImage&token=u&img=' + image_name;
	$("#image_placeholder_"+$('#sidechnage').val()).append("<div style='position:absolute;top:35%;left:60%;'><img id="+ uniqId +" class='resize' width='80' height='80' data-angle='0' src=" + image_url + " /></div>");
	makeObjDragAndResize(uniqId,$('#sidechnage').val());
	// store into array from add image
	storeIntoArray(uniqId,image_name,0,0,0,0,0, 'upload_image');
	$("#"+uniqId).before("<div title='Delete' id=rmv_" + uniqId +" onclick=removeImage('" + uniqId + "'); class='delete_icon'></div>");
	hideCorner(2);
  }

  function updateArrayObjectById(id,update_key,update_value){
	if($('#sidechnage').val() == 'front'){
		for(i=0;i<design_work_front.length;i++){
			if(typeof(design_work_back[i]) !='undefined' && $.trim(design_work_front[i]['id']) == $.trim(id)){
				design_work_front[i][update_key] = update_value;
			}
		}
	}
	else if($('#sidechnage').val() == 'back'){
		for(i=0;i<design_work_back.length;i++){
			if(typeof design_work_back[i] !='undefined' && $.trim(design_work_back[i]['id']) == $.trim(id)){
				design_work_back[i][update_key] = update_value;
			}
		}
	}
  }

  function removeOldFromArray(id){
  	if($('#sidechnage').val() == 'front'){
		for(i=0;i<design_work_front.length;i++){
			if(typeof design_work_front[i] != "undefined" && $.trim(design_work_front[i]['id']) == $.trim(id)){
				delete design_work_front[i];
			}
		}

        var newArray = new Array();
        for (var i = 0; i < design_work_front.length; i++) {
            if (design_work_front[i]) {
                newArray.push(design_work_front[i]);
            }
        }
        design_work_front = newArray;
	}
	else if($('#sidechnage').val() == 'back'){
		for(i=0;i<design_work_back.length;i++){
			if(typeof design_work_back[i] != "undefined" && $.trim(design_work_back[i]['id']) == $.trim(id)){
				delete design_work_back[i];
			}
		}

        var newArray = new Array();
        for (var i = 0; i < design_work_back.length; i++) {
            if (design_work_back[i]) {
                newArray.push(design_work_back[i]);
            }
        }
        design_work_back = newArray;
	}
  }

  function storeHidden(productId){
  	$('#arrayobjectfront').val(JSON.stringify(design_work_front));
	$('#arrayobjectback').val(JSON.stringify(design_work_back));
 $.ajax({
	   type: "POST",
	   url: 'index.php?route=module/product_designer/mergeImage',
	   data: $("#sform").serialize() + '&pid=' + productId,
	   dataType: 'json',
	   success: function(json) {
	   	$('#lastTshirtId').val(json);
		}
	 });
  }

  function setImage(side, _this){
  	$('#sidechnage').val(side);
  	if(side == 'front'){
        if (typeof _this != 'undefined') {
            $('#image_placeholder_front').css('background-image', 'url(' + $(_this).attr('data-org') + ')');
        }
		$('#front').show();
		$('#back').hide();
	}
	else if(side == 'back'){
		$('#front').hide();
		$('#back').show();
	}
	else if(side == 'left'){
		$('#front').hide();
		$('#back').hide();
	}
	else if(side == 'right'){
		$('#front').hide();
		$('#back').hide();
	}
  }

function saveIntoArrayAfterConvertTextToImage(uniqId){
	var image_url = "{{ dirImage }}modules/pd_images/upload_image/" + uniqId + ".png";
	var image_name = uniqId + '.png';
	$("#image_placeholder_"+$('#sidechnage').val()).append("<div style='position:absolute;top:35%;left:60%;'><img id="+ uniqId +" class='resize' width='150' height='45' data-angle='0' src="+ image_url +" /></div>");
	makeObjDragAndResize(uniqId,$('#sidechnage').val());
	// store into array from add text
	storeIntoArray(uniqId,image_name,0,0,0,0,0, 'add_text');
	$("#"+uniqId).before("<div title='Delete' id=rmv_" + uniqId +" onclick=removeImage('" + uniqId + "'); class='delete_icon'></div>");
	hideCorner(2);
}
function createTextToImage(obj){
	var uniqId = uniqueid();
	createAjaxImage($('#designtext').val(),uniqId);
	setTimeout("saveIntoArrayAfterConvertTextToImage('" + uniqId + "')",1000);
}
function createAjaxImage(text,guid){
	$('#ajaxloader').show();
	var str = "index.php?route=module/product_designer/createTextToImage&col=" + $('#tcolor').val() + "&bg=F24B17&ft=" + $('#optfont').val() + "&guid=" + guid;
	$.ajax({
		type: "POST",
		url: str,
		data: 'str=' + text,
		success: function(msg) {
			setTimeout("$('#ajaxloader').hide()",2000);
		},
	});
}
function addCartProduct(qty, productId, lastTshirtId){
	var lastTshirtIdVal = $('#lastTshirtId').val();
	var dataObj = $("#frmDesignUpload").serialize() + '&option[pd_application][customId]='+$('#uniqid').val() + '&quantity=' + qty;
	dataObj = dataObj + '&option[pd_application][pd_application]=true';
	dataObj = dataObj + '&option[pd_application][pid]=' + productId;
	dataObj = dataObj + '&option[pd_application][lastTshirtId]=' + lastTshirtIdVal;
	$.ajax({
           type: "POST",
           url: 'index.php?route=checkout/cart/add',
           data: dataObj,
		   dataType: 'json',
           success: function(json) {
               if(json['success'] == 'affiliate_link') {
                   document.location = json['affiliate_link'];
                   return;
               }

               $('.success, .warning, .attention, information, .error').remove();

				if (json['error']) {
					$('#addprocess').hide();
					if (json['error']['option']) {
						for (i in json['error']['option']) {
							$('#option-' + i).after('<span class="error">' + json['error']['option'][i] + '</span>');
						}
					}
				}

				if (json['success']) {
					$('#addprocess').hide();
					window.parent.closeModel();
					parent.addCartStyle(json);
				}
			}
         });
    return false;
}
function saveDesign(productId){
	var qty = jQuery("#quantity").val();
	var minqty = {{min_cust_qty}};
	if(qty != '' && qty > 0){
		if(qty >= minqty){
			//mergeImage(productId);
			{% if isoption is defined %}
				$('#addprocess').show();
				saveEachImage(productId);
				setTimeout('storeHidden('+productId+')',5000);
				setTimeout('addCartProduct('+qty+', '+productId+')',12000);
			{% else %}
				$('#addprocess').show();
				saveEachImage(productId);
				setTimeout('storeHidden('+productId+')',5000);
				setTimeout("addToCardWithoutOption("+productId+","+qty+")",10000);
			{% endif %}

			lastTshirtId = 0;
		}
		else {
			alert('{{cust_min_alert_text}}' + " " + minqty);
			jQuery("#quantity").focus()
		}
	}
	else{
		alert("Quantity Required");
		jQuery("#quantity").focus();
	}
}
function addToCardWithoutOption(productId,qty){
	window.parent.closeModel();
	parent.addcart(productId,qty,$('#uniqid').val());
}
</script>
<script type="text/javascript"><!--
$('#tabs a').tabs();
//--></script>
<script type="text/javascript">
jQuery(function(){
	var btnUpload=$('#upload');
	//var status=$('#status');
	new AjaxUpload(btnUpload, {
		action: 'index.php?route=module/product_designer/uploadImage',
		name: 'uploadfile',
		onSubmit: function(file, ext){
			 $('#alimageupload').show();
			 if (! (ext && /^(jpg|png|jpeg|gif)$/.test(ext))){
				alert('Only JPG, PNG or GIF files are allowed');
				$('#alimageupload').hide();
				return false;
			}
		},
		onComplete: function(file, response){
			if(response != 'error' && response != '-9'){
				sendImageToPanelAfterUplaod(response);
			}
			else if(response == '-9'){
				alert('Only JPG, PNG or GIF files are allowed');
			}
			else{
				alert('upload error, please try again');
			}
			$('#alimageupload').hide();
		}
	});

});
function uniqueid(){
    var idstr=String.fromCharCode(Math.floor((Math.random()*25)+65));
    do {
        var ascicode=Math.floor((Math.random()*42)+48);
        if (ascicode<58 || ascicode>64){
            idstr+=String.fromCharCode(ascicode);
        }
    } while (idstr.length<32);
    return (idstr);
}
$(function(){
	$('#front').show();
});
function delaysaveImage(side, productId){
	setImage(side);
    html2canvas($('#'+side), {
		// proxy: '{{designdic}}html2canvasproxy.php',
        proxy: '{{ link("module/product_designer/proxy") }}',
        useCORS: true,
		onrendered: function(canvas) {
			var dataURL = canvas.toDataURL("image/png");
			$.post('index.php?route=module/product_designer/saveImage',{image: dataURL,side: side, productId: productId},function(data){});
		}
	});
}
function saveEachImage(productId){
	setTimeout("delaysaveImage('front', " + productId + ")",1000);
	setTimeout("delaysaveImage('back', " + productId + ")",2000);
}
function showCurrentSidePreview(){
	html2canvas($('#'+$('#sidechnage').val()), {
		proxy: '{{designdic}}html2canvasproxy.php',
		onrendered: function(canvas) {
			var dataURL = canvas.toDataURL("image/png");
			jQuery("#imageHolder").dialog({
			 modal: true
			 , width: 400
			 , height: 450
			 , resizable: false
			 , draggable: false
			});
			jQuery("#imageHolder").html("<img src="+dataURL+" />");
		}
	});
}
function hideCorner(token){
	if(token == 1){jQuery('.ui-resizable-se').show();$(".delete_icon").show();}
	else{jQuery('.ui-resizable-se').hide();$(".delete_icon").hide();}
}
function loadImage(catid){
	$('#added_logo_loader').show();
	var str = 'index.php?route=module/product_designer/getclipartimage&catid=' + catid;
	$.ajax({
		type: "GET",
		url: str,
		success: function(output) {
			$('#showimages').html(output);
			$('#showimages').show();
			$('#catlist').hide();
			$('#added_logo_loader').hide();
		},
	});
}
function switchpanel(){
	$('#showimages').html('');
	$('#showimages').hide();
	$('#catlist').show();
}
</script>
</body>
</html>
